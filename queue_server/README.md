# 대기열 서버

- [아키텍처 설계](./docs/architecture.md)
- [네트워크 이슈 대응](./docs/network.md)

## 목적

- 특정 기간(예: 이벤트, 티켓팅 등) 트래픽이 집중되는 상황에서도 **백엔드 API 서버의 안정성**을 유지하고, **사용자 경험의 일관성**을 제공하기 위한 **중간 게이트웨이 시스템** 구축.

---

## 기능 요구사항

1. ### 요청 제한 (Rate Protection)
   - API 서버는 **초당 1000건 이상의 요청을 받지 않도록 제한**한다.
   - 현재 1분 기준 처리량을 측정하고, **THRESHOLD 초과 시 요청을 제한하거나 대기열로 분기**한다.

2. ### 티켓 기반 통제
   - `THRESHOLD` 이상일 경우 **UUID 기반의 ticket**을 발급한다.
   - ticket은 **TTL 기반으로 관리되며**, 순서 도래 시 우선적으로 입장할 수 있도록 한다.
   - ticket을 통해 **사용자 인증 및 중복 요청 방지**가 가능해야 한다.

3. ### 대기 정보 확인
   - 사용자는 자신의 대기 상태를 확인할 수 있어야 한다.
     - 대기열 내 현재 순번
     - 예상 대기 시간 (ETA: Estimated Time of Arrival)
   - ETA는 **평균 처리 속도 기반의 추정값**으로 제공한다.

4. ### polling 및 이탈 처리
   - 사용자는 클라이언트에서 **polling을 통해 정기적으로 대기 상태를 확인**한다.
   - 사용자가 **페이지를 이탈하거나 polling을 중단할 경우**, 서버는 해당 ticket 및 대기열 정보를 제거해야 한다.
     - 클라이언트 측 `beforeunload` 또는 `heartbeat` 신호 활용
     - 서버 측에서는 TTL 또는 마지막 ping timestamp 기준 판단

5. ### 처리량 여유 시 직접 진입
   - 요청이 `THRESHOLD` 이하일 경우, **ticket 발급 없이 즉시 API 서버에 요청이 전달**되도록 한다.
   - 이 경우 사용자는 별도 대기 없이 바로 서비스 이용 가능하다.

---